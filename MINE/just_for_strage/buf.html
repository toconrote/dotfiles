<head>
<script src="jquery/jquery-1.11.3.min.js"></script>
<style>
.cf:before,
.cf:after {
  content: " ";
  display: table;
}
.cf:after {
  clear: both;
}
.cf {
  *zoom: 1;
}
.table {
  padding: 10px;
  border: 1px solid #d0d0d0;
  border-radius: 5px;
  float: left;
}
.sec {
  width: 60px;
  text-align: center;
}
</style>
</head>
<div id="turn" class="cf">
  <div class="table">
    <table>
      <tbody>
      <tr>
        <td><input type="checkbox">ターンエンド</td>
        <td><span data-second="15">15秒</span></td>
        <td><input id="0"type="button" onclick="setT(this)" value="更新"></td>
      </tr>
      <tr>
        <td><input type="checkbox">ヘビチャ</td>
        <td><span data-second="60">60秒</span></td>
        <td><input id="1"type="button" onclick="setT(this)" value="更新"></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
<div style="margin-top: 50px">
  <p>名<input type="text" id="addSkill"></p>
  <p>秒<input type="text" id="addSecond" style="width:50px"></p>
  <p><input type="button" value="追加" onclick="addFromDisp()"></p>
  <p>チェックの入った項目を<input type="button" value="削除" onclick="del()"></p>
</div>
<script>
var t = {};

//クッキー読み込み
if(document.cookie){

} else {
  alert("")
}

function setT(tar){
  target = $("#"+tar.id).parent().prev().children().first();
  s = parseInt(target.attr("data-second"));
  if(t[tar.id])clearInterval(t[tar.id]);
  t[tar.id] = setInterval(count, 50, target, s, new Date(), tar.id);
}
function count(target, s, date, id){
  cs = Math.floor((new Date() - date) / 1000);
  target.text((s-cs) + '秒');
  if(s-cs==0){
    clearInterval(t[id]);
    target.text(s+'秒');
  }
}
function addFromDisp() {
  skill = $("#addSkill").val();
  second = $("#addSecond").val();
  if(skill=="")return;
  if(second=="" || isNaN(second))return;
  add(skill, second);
  $("#addSkill").val("").focus();
  $("#addSecond").val("");
}
function add(skill, second) {
  addid = getEmptyID();
  $("tbody").append("<tr>").children().last().append('<td><input type="checkbox">'+skill+
      '</td><td class="sec"><span data-second="'+second+'">'+second+
      '秒</span></td><td><input id="'+addid+'" type="button" onclick="setT(this)" value="更新"></td>');
}
function del() {
  trs = $("tbody").children();
  len = trs.length;
  for(i=len-1;i>=0;i--){
    if($(trs[i]).find("input[type='checkbox']").prop("checked")){
      trs[i].remove();
    }
  }
}
function getEmptyID() {
  buf = [];
  $("tbody").find("input[id]").each(function(){
      buf[parseInt($(this).attr("id"))] = true;
      });
  len = buf.length;
  blankid = len;
  for(i=0;i<len-1;i++){
    if(!buf[i]){
      blankid = i;
      break;
    }
  }
  return blankid;
}
$("#addSecond").keydown(function(e){
    if(e.which=="13")addFromDisp();
    })
</script>
